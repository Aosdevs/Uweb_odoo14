<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<template id="manifest" name="Webapp Manifest">
	{
	    "name": "<t t-esc="app_name_pwa_backend"/>",
	    "short_name": "<t t-esc="short_name_pwa_backend"/>",
	    "icons": [{
	        "sizes": "192x192",
	        "src": "<t t-esc="image_192_pwa_backend"/>",
	        "type": "image/png"
	    },{
	        "sizes": "512x512",
	        "src": "<t t-esc="image_512_pwa_backend"/>",
	        "type": "image/png"
	    }],
        "start_url": "<t t-esc="start_url_pwa_backend" />",
	    "display": "standalone",
	    "scope": "/",
	    "background_color": "<t t-esc="background_color_pwa_backend"/>",
	    "theme_color": "<t t-esc="theme_color_pwa_backend"/>",
        "shortcuts":[
            <t t-set="count" t-value="0"/>
            <t t-foreach="pwashortlistas" t-as="shorts">
            <t t-set="count" t-value="count + 1"/>
            {
            "name": "<t t-esc="shorts.name"/>",
            "short_name": "<t t-esc="shorts.short_name"/>",
            "description": "<t t-esc="shorts.description"/>",
            "url": "<t t-esc="shorts.url"/>",
            "icons": [{"src": "/web/image/pwa.shortcuts/<t t-esc="shorts.id"/>/image_192_shortcut","sizes": "192x192",  "type": "image/png"}]
            }<t t-if="not count==len(pwashortlistas)">,</t>
        </t>]
	}
</template>

<template id="service_worker_backend" name="PWA service worker">
    'use strict';
        var base_cache_ver = 'base-cache-1';
        var assets = ['/','/pwa/offline'];
        self.addEventListener('install', function(event) {
            self.skipWaiting();
            event.waitUntil(
                caches.open(base_cache_ver).then(cache =>{
                    cache.addAll(assets);
                })
            )
        });
        self.addEventListener('activate', function(event) {
            event.waitUntil(
                caches.keys().then(function(keys) {
                    return Promise.all(keys.map(function(key) {
                        if (key !== base_cache_ver) {
                            return caches.delete(key);
                        }
                    }));
                })
            );
        });
        self.addEventListener('fetch', function(event) {
            event.respondWith(
                fetch(event.request).then(function (response) {
                    return response;
                })
                .catch(error => {
                    return caches.match('/pwa/offline');
            }));
        });
    </template>

    <template id="biz_web_layout_inheirt" name="Web Main layout" inherit_id="web.layout">
        <xpath expr="//head" position="inside">
            <t t-set="company" t-value="request.env.company.sudo()"/>
            <t t-set="enable_pwa_backend" t-value="company.enable_pwa_backend"/>
            <t t-if="enable_pwa_backend">
                <link rel="manifest" t-att-href="'/spiffy_theme_backend/%s/manifest.json' % (company.id) "/>
                <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
                <meta name="apple-mobile-web-app-title" content="PWA"/>
                
                <link rel="apple-touch-icon" t-att-href="'/web/image/res.company/%s/image_512_pwa_backend/152x152' % (company.id)"/>
                <meta name="apple-mobile-web-app-capable" content="yes"/>
            </t>
        </xpath>
    </template>

</odoo>